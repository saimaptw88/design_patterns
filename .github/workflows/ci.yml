name: CI

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
     - name: Git checkout
       uses: actions/checkout@v2

     - name: Setup python
       uses: actions/setup-python@v2

     - name: Setup apt-get
       run: |
         sudo apt-get update -y \
         && sudo apt-get upgrade -y \
         && sudo apt-get install -y wget

     - name: Setup lint
       run: |
         pip3 install cpplint

     - name: Setup Test
       run: |
         GOOGLE_TEST_VERSION=1.12.0
         curl -OL https://github.com/google/googletest/archive/release-${GOOGLE_TEST_VERSION}.tar.gz \
         && tar -zxvf release-${GOOGLE_TEST_VERSION}.tar.gz \
         && cd googletest-release-${GOOGLE_TEST_VERSION} \
         && mkdir build \
         && cd build \
         && cmake .. \
         && make \
         && sudo make install

     - name: Setup Boost
       run: |
         BOOST_VERSION=1.82.0
         BOOST_VERSION_MOD=$(echo $BOOST_VERSION | tr . _) \
         && wget https://boostorg.jfrog.io/artifactory/main/release/${BOOST_VERSION}/source/boost_${BOOST_VERSION_MOD}.tar.bz2 \
         && tar --bzip2 -xf boost_${BOOST_VERSION_MOD}.tar.bz2 \
         && cd boost_${BOOST_VERSION_MOD} \
         && ./bootstrap.sh --prefix=/usr/local \
         && ./b2 install

     - name: Build
       run: |
         mkdir build \
         && cd build \
         && cmake .. \
         && make

     - name: Cpp Lint
       run: |
         cd src \
         && cpplint --recursive . \
         && cd ../

     - name: Google Test
       run: |
         cd build \
         && ctest --verbose
